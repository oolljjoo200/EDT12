&НаКлиенте
Процедура ЗагрузитьИзXML(Команда)
    ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
    ДиалогВыбораФайла.Фильтр = "XML-файлы (*.xml)|*.xml";
    ДиалогВыбораФайла.Заголовок = "Выберите XML-файл для загрузки";
    
    Если ДиалогВыбораФайла.Выбрать() Тогда
        ИмяФайла = ДиалогВыбораФайла.ПолноеИмяФайла;
        ПопыткаЗагрузитьИзXMLНаСервере(ИмяФайла);
    КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПопыткаЗагрузитьИзXMLНаСервере(ИмяФайла)
    Попытка
        ЗагрузитьИзXMLНаСервере(ИмяФайла);
        СообщитьПользователю("Файл успешно загружен", "Успех");
    Исключение
        ИнформацияОбОшибке = ИнформацияОбОшибке();
        СообщитьПользователю(ИнформацияОбОшибке.Описание, "Ошибка");
    КонецПопытки;
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьИзXMLНаСервере(ИмяФайла)
    Чтение = Новый ЧтениеXML;
    Попытка
        Чтение.ОткрытьФайл(ИмяФайла);
        СтруктураДанных = ПрочитатьПроизвольнуюСтруктуруИзXML(Чтение);
        ЗаполнитьТаблицуПроизвольнойСтруктуры(СтруктураДанных);
    Исключение
        ВызватьИсключение "Ошибка при чтении файла: " + ОписаниеОшибки();
    КонецПопытки;
    Чтение.Закрыть();
КонецПроцедуры

&НаСервере
Функция ПрочитатьПроизвольнуюСтруктуруИзXML(Чтение)
    СтекЭлементов = Новый Массив;
    ТекущаяСтруктура = Новый Структура;
    КорневаяСтруктура = ТекущаяСтруктура;
    
    Пока Чтение.Прочитать() Цикл
        Если Чтение.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
            НовыйЭлемент = Новый Структура;
            
            Если Чтение.КоличествоАтрибутов() > 0 Тогда
                Для Ном = 0 По Чтение.КоличествоАтрибутов() - 1 Цикл
                    ИмяАтрибута = Чтение.ИмяАтрибута(Ном);
                    ЗначениеАтрибута = Чтение.ЗначениеАтрибута(Ном);
                    НовыйЭлемент.Вставить(ИмяАтрибута, ЗначениеАтрибута);
                КонецЦикла;
            КонецЕсли;
            
            ТекстЭлемента = ПрочитатьЗначениеЭлемента(Чтение);
            Если ЗначениеЗаполнено(ТекстЭлемента) Тогда
                НовыйЭлемент.Вставить("Значение", ТекстЭлемента);
            КонецЕсли;
            
            ТекущаяСтруктура.Вставить(Чтение.Имя, НовыйЭлемент);
            СтекЭлементов.Добавить(ТекущаяСтруктура);
            ТекущаяСтруктура = НовыйЭлемент;
        ИначеЕсли Чтение.ТипУзла = ТипУзлаXML.КонецЭлемента Тогда
            Если СтекЭлементов.Количество() > 0 Тогда
                ТекущаяСтруктура = СтекЭлементов[СтекЭлементов.Количество() - 1];
                СтекЭлементов.Удалить(СтекЭлементов.Количество() - 1);
            КонецЕсли;
        КонецЕсли;
    КонецЦикла;
    
    Возврат КорневаяСтруктура;
КонецФункции

&НаСервере
Функция ПрочитатьЗначениеЭлемента(Чтение)
    Значение = "";
    Пока Чтение.Прочитать() Цикл
        Если Чтение.ТипУзла = ТипУзлаXML.Текст Тогда
            Значение = Значение + Чтение.Значение;
        ИначеЕсли Чтение.ТипУзла = ТипУзлаXML.КонецЭлемента Тогда
            Прервать;
        КонецЕсли;
    КонецЦикла;
    Возврат СокрЛП(Значение);
КонецФункции

&НаСервере
Функция Повтор(Строка, Количество)
    Результат = "";
    Для i = 1 По Количество Цикл
        Результат = Результат + Строка;
    КонецЦикла;
    Возврат Результат;
КонецФункции

&НаСервере
Процедура ЗаполнитьТаблицуПроизвольнойСтруктуры(Данные)
    ТабличныйДокумент.Очистить();
    
    Если Данные = Неопределено Тогда
        Возврат;
    КонецЕсли;
    
    // Выводим заголовок
    ТабличныйДокумент.Область(1, 1).Текст = "Структура XML";
    
    // Выводим данные
    НомерСтроки = 2;
    ВывестиСтруктуруВТабличныйДокумент(Данные, 0, НомерСтроки);
    
    ТабличныйДокумент.Защита = Ложь;
    ТабличныйДокумент.ТолькоПросмотр = Истина;
    Попытка
        ТабличныйДокумент.ФиксацияСверху = 1;
        ТабличныйДокумент.ФиксацияСлева = 1;
    Исключение
        // Игнорируем ошибку, если свойства не поддерживаются
    КонецПопытки;
КонецПроцедуры

&НаСервере
Процедура ВывестиСтруктуруВТабличныйДокумент(Структура, Уровень, НомерСтроки)
    Для Каждого КлючИЗначение ИЗ Структура Цикл
        Ключ = КлючИЗначение.Ключ;
        Значение = КлючИЗначение.Значение;
        
        Если ТипЗнч(Значение) = Тип("Структура") Тогда
            ТабличныйДокумент.Область(НомерСтроки, 1).Текст = Повтор("    ", Уровень) + Ключ + ":";
            НомерСтроки = НомерСтроки + 1;
            ВывестиСтруктуруВТабличныйДокумент(Значение, Уровень + 1, НомерСтроки);
        Иначе
            ТабличныйДокумент.Область(НомерСтроки, 1).Текст = Повтор("    ", Уровень) + Ключ + ": " + Строка(Значение);
            НомерСтроки = НомерСтроки + 1;
        КонецЕсли;
    КонецЦикла;
КонецПроцедуры

// Остальной код остается без изменений
&НаКлиентеНаСервереБезКонтекста
Процедура СообщитьПользователю(Текст, Заголовок = "") Экспорт
    #Если Клиент Тогда
        ПоказатьПредупреждение(, Текст, 30, Заголовок);
    #Иначе
        Сообщить(Текст);
    #КонецЕсли
КонецПроцедуры