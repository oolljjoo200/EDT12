
&НаКлиенте
Процедура Читать(Команда)
	ПрочитатьФайлНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПрочитатьФайлНаСервере()
    ПутьКФайлу = "C:\Users\user\Pictures\XML\Файл выгрузки.xml";
    РезультатЧтения = ПрочитатьXMLФайл(ПутьКФайлу);
    
    ТабличныйДокумент = СтруктураВТаблицу(РезультатЧтения);
    
    // Предполагается, что у вас есть реквизит формы ТабличныйДокумент
    ТабличныйДокумент1 = ТабличныйДокумент;
КонецПроцедуры

Функция ПрочитатьXMLФайл(ПутьКФайлу)
    ЧтениеXML = Новый ЧтениеXML;
    ЧтениеXML.ОткрытьФайл(ПутьКФайлу);
    
    Результат = Новый Структура;
    ПрочитатьУзел(ЧтениеXML, Результат);
    
    ЧтениеXML.Закрыть();
    
    Возврат Результат;
КонецФункции

Процедура ПрочитатьУзел(ЧтениеXML, Родитель)
    Пока ЧтениеXML.Прочитать() Цикл
        Если ЧтениеXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
            ИмяУзла = ЧтениеXML.Имя;
            НовыйУзел = Новый Структура;
            
            Если Родитель.Свойство(ИмяУзла) Тогда
                Если ТипЗнч(Родитель[ИмяУзла]) <> Тип("Массив") Тогда
                    Родитель[ИмяУзла] = Новый Массив;
                    Родитель[ИмяУзла].Добавить(НовыйУзел);
                Иначе
                    Родитель[ИмяУзла].Добавить(НовыйУзел);
                КонецЕсли;
            Иначе
                Родитель.Вставить(ИмяУзла, НовыйУзел);
            КонецЕсли;
            
            ПрочитатьУзел(ЧтениеXML, НовыйУзел);
        ИначеЕсли ЧтениеXML.ТипУзла = ТипУзлаXML.Текст Тогда
            Родитель.Вставить("Значение", ЧтениеXML.Значение);
        ИначеЕсли ЧтениеXML.ТипУзла = ТипУзлаXML.КонецЭлемента Тогда
            Возврат;
        КонецЕсли;
    КонецЦикла;
КонецПроцедуры

Функция СтруктураВТаблицу(Структура)
    ТабДок = Новый ТабличныйДокумент;
    ТабДок.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПрочитанныйXML";
    
    // Добавляем заголовок таблицы
    ТабДок.ПолеТабличногоДокумента.Вывести("Ключ", 1, 1);
    ТабДок.ПолеТабличногоДокумента.Вывести("Значение", 1, 2);
    
    СтрокаТабДок = 2;
    ДобавитьСтрокиВТаблицу(Структура, ТабДок, СтрокаТабДок);
    
    Возврат ТабДок;
КонецФункции

Процедура ДобавитьСтрокиВТаблицу(Структура, ТабДок, СтрокаТабДок, Префикс = "")
    Для Каждого КлючИЗначение Из Структура Цикл
        Ключ = КлючИЗначение.Ключ;
        Значение = КлючИЗначение.Значение;
        
        Если ТипЗнч(Значение) = Тип("Структура") Тогда
            ТабДок.ПолеТабличногоДокумента.Вывести(Префикс + Ключ, СтрокаТабДок, 1);
            СтрокаТабДок = СтрокаТабДок + 1;
            ДобавитьСтрокиВТаблицу(Значение, ТабДок, СтрокаТабДок, Префикс + "    ");
        ИначеЕсли ТипЗнч(Значение) = Тип("Массив") Тогда
            Для Индекс = 0 По Значение.ВГраница() Цикл
                ТабДок.ПолеТабличногоДокумента.Вывести(Префикс + Ключ + "[" + Формат(Индекс, "ЧГ=0") + "]", СтрокаТабДок, 1);
                СтрокаТабДок = СтрокаТабДок + 1;
                ДобавитьСтрокиВТаблицу(Значение[Индекс], ТабДок, СтрокаТабДок, Префикс + "    ");
            КонецЦикла;
        Иначе
            ТабДок.ПолеТабличногоДокумента.Вывести(Префикс + Ключ, СтрокаТабДок, 1);
            ТабДок.ПолеТабличногоДокумента.Вывести(Значение, СтрокаТабДок, 2);
            СтрокаТабДок = СтрокаТабДок + 1;
        КонецЕсли;
    КонецЦикла;
КонецПроцедуры

